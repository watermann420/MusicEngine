# General MIDI Instruments

MusicEngine provides full access to Windows built-in General MIDI synthesizer (Microsoft GS Wavetable Synth), offering all 128 standard GM instruments for quick prototyping and realistic instrument sounds.

## Overview

General MIDI (GM) is a standardized specification that ensures consistent sound across different MIDI devices. Windows includes a software synthesizer that implements this standard, providing:

- **128 standard instruments** across 16 categories
- **16 MIDI channels** for layering and orchestration
- **Full MIDI control** including volume, pan, expression, reverb, chorus, modulation, and sustain
- **Pitch bend and control changes** for expressive performance
- **Zero latency** - sounds are generated by the operating system
- **No sample loading required** - instruments are always ready

## Quick Start

```csharp
// Create a piano
var piano = gm(GeneralMidiProgram.AcousticGrandPiano);

// Play some notes
var pattern = CreatePattern(piano);
pattern.AddNote(0.0, 60, 100, 0.5);  // C4
pattern.AddNote(0.5, 64, 100, 0.5);  // E4
pattern.AddNote(1.0, 67, 100, 0.5);  // G4
pattern.AddNote(1.5, 72, 100, 1.0);  // C5
pattern.Loop = true;

// Start playback
SetBpm(120);
pattern.Play();
Start();
```

## Creating GM Instruments

### Basic Creation

```csharp
// Full form
var piano = CreateGeneralMidiInstrument(GeneralMidiProgram.AcousticGrandPiano);

// Short form (recommended)
var guitar = gm(GeneralMidiProgram.AcousticGuitarSteel);

// Alternative
var bass = newGm(GeneralMidiProgram.ElectricBassFinger);
```

### Multi-Channel Setup

Use different MIDI channels to layer instruments or create complex arrangements:

```csharp
// Piano on channel 0
var piano = gm(GeneralMidiProgram.AcousticGrandPiano, 0);

// Electric piano on channel 1
var epiano = gm(GeneralMidiProgram.ElectricPiano1, 1);

// Bass on channel 2
var bass = gm(GeneralMidiProgram.FretlessBass, 2);

// Drums on channel 9 (GM standard for drums)
var drums = gm(GeneralMidiProgram.SynthDrum, 9);
```

## Instrument Categories

### Piano (0-7)
Perfect for classical, jazz, and pop music.

```csharp
var acoustic = gm(GeneralMidiProgram.AcousticGrandPiano);
var bright = gm(GeneralMidiProgram.BrightAcousticPiano);
var electric = gm(GeneralMidiProgram.ElectricPiano1);
var honkyTonk = gm(GeneralMidiProgram.HonkyTonkPiano);
var harpsichord = gm(GeneralMidiProgram.Harpsichord);
```

### Chromatic Percussion (8-15)
Melodic percussion instruments like vibraphone and marimba.

```csharp
var vibes = gm(GeneralMidiProgram.Vibraphone);
var marimba = gm(GeneralMidiProgram.Marimba);
var bells = gm(GeneralMidiProgram.TubularBells);
```

### Organ (16-23)
Church, rock, and jazz organs.

```csharp
var drawbar = gm(GeneralMidiProgram.DrawbarOrgan);
var rock = gm(GeneralMidiProgram.RockOrgan);
var church = gm(GeneralMidiProgram.ChurchOrgan);
```

### Guitar (24-31)
Acoustic and electric guitars with various timbres.

```csharp
var nylon = gm(GeneralMidiProgram.AcousticGuitarNylon);
var steel = gm(GeneralMidiProgram.AcousticGuitarSteel);
var clean = gm(GeneralMidiProgram.ElectricGuitarClean);
var distortion = gm(GeneralMidiProgram.DistortionGuitar);
```

### Bass (32-39)
Acoustic, electric, and synth bass sounds.

```csharp
var acoustic = gm(GeneralMidiProgram.AcousticBass);
var finger = gm(GeneralMidiProgram.ElectricBassFinger);
var pick = gm(GeneralMidiProgram.ElectricBassPick);
var fretless = gm(GeneralMidiProgram.FretlessBass);
var slap = gm(GeneralMidiProgram.SlapBass1);
```

### Strings (40-47)
Orchestral string instruments and ensembles.

```csharp
var violin = gm(GeneralMidiProgram.Violin);
var viola = gm(GeneralMidiProgram.Viola);
var cello = gm(GeneralMidiProgram.Cello);
var tremolo = gm(GeneralMidiProgram.TremoloStrings);
var pizzicato = gm(GeneralMidiProgram.PizzicatoStrings);
```

### Ensemble (48-55)
String and voice ensembles.

```csharp
var strings = gm(GeneralMidiProgram.StringEnsemble1);
var choir = gm(GeneralMidiProgram.ChoirAahs);
var voice = gm(GeneralMidiProgram.VoiceOohs);
var hit = gm(GeneralMidiProgram.OrchestraHit);
```

### Brass (56-63)
Trumpet, trombone, tuba, and brass sections.

```csharp
var trumpet = gm(GeneralMidiProgram.Trumpet);
var trombone = gm(GeneralMidiProgram.Trombone);
var horn = gm(GeneralMidiProgram.FrenchHorn);
var section = gm(GeneralMidiProgram.BrassSection);
```

### Reed (64-71)
Saxophone, oboe, clarinet, and other reed instruments.

```csharp
var alto = gm(GeneralMidiProgram.AltoSax);
var tenor = gm(GeneralMidiProgram.TenorSax);
var clarinet = gm(GeneralMidiProgram.Clarinet);
var oboe = gm(GeneralMidiProgram.Oboe);
```

### Pipe (72-79)
Flute, recorder, and ethnic pipes.

```csharp
var flute = gm(GeneralMidiProgram.Flute);
var piccolo = gm(GeneralMidiProgram.Piccolo);
var panFlute = gm(GeneralMidiProgram.PanFlute);
var whistle = gm(GeneralMidiProgram.Whistle);
```

### Synth Lead (80-87)
Synthesizer lead sounds for electronic music.

```csharp
var square = gm(GeneralMidiProgram.Lead1Square);
var sawtooth = gm(GeneralMidiProgram.Lead2Sawtooth);
```

### Synth Pad (88-95)
Ambient and atmospheric synthesizer pads.

```csharp
var warm = gm(GeneralMidiProgram.Pad2Warm);
var polysynth = gm(GeneralMidiProgram.Pad3Polysynth);
var choir = gm(GeneralMidiProgram.Pad4Choir);
```

### Synth Effects (96-103)
Special effect sounds.

```csharp
var rain = gm(GeneralMidiProgram.FX1Rain);
var crystal = gm(GeneralMidiProgram.FX3Crystal);
var atmosphere = gm(GeneralMidiProgram.FX4Atmosphere);
```

### Ethnic (104-111)
World music instruments.

```csharp
var sitar = gm(GeneralMidiProgram.Sitar);
var banjo = gm(GeneralMidiProgram.Banjo);
var koto = gm(GeneralMidiProgram.Koto);
```

### Percussive (112-119)
Tuned percussion instruments.

```csharp
var steelDrums = gm(GeneralMidiProgram.SteelDrums);
var woodblock = gm(GeneralMidiProgram.Woodblock);
var taiko = gm(GeneralMidiProgram.TaikoDrum);
```

### Sound Effects (120-127)
Special sound effects.

```csharp
var seashore = gm(GeneralMidiProgram.Seashore);
var birds = gm(GeneralMidiProgram.BirdTweet);
var applause = gm(GeneralMidiProgram.Applause);
```

## Parameter Control

### Volume

```csharp
var piano = gm(GeneralMidiProgram.AcousticGrandPiano);

// Set volume to 75%
piano.Volume = 0.75f;

// Or use SetParameter
piano.SetParameter("volume", 0.75f);
```

### Pan

```csharp
var guitar = gm(GeneralMidiProgram.AcousticGuitarSteel);

// Pan to left (-1.0 = full left, 0.0 = center, 1.0 = full right)
guitar.SetParameter("pan", -0.5f);
```

### Expression

```csharp
var strings = gm(GeneralMidiProgram.StringEnsemble1);

// Control dynamic expression
strings.SetParameter("expression", 0.8f);
```

### Reverb and Chorus

```csharp
var pad = gm(GeneralMidiProgram.Pad2Warm);

// Add reverb
pad.SetParameter("reverb", 0.6f);

// Add chorus
pad.SetParameter("chorus", 0.4f);
```

### Modulation

```csharp
var lead = gm(GeneralMidiProgram.Lead2Sawtooth);

// Apply modulation wheel
lead.SetParameter("modulation", 0.5f);
```

### Sustain Pedal

```csharp
var piano = gm(GeneralMidiProgram.AcousticGrandPiano);

// Sustain on (>0.5)
piano.SetParameter("sustain", 1.0f);

// Sustain off
piano.SetParameter("sustain", 0.0f);
```

## Pitch Bend

```csharp
var lead = gm(GeneralMidiProgram.Lead2Sawtooth);

// Play a note
lead.NoteOn(60, 100);

// Bend pitch up by 1 semitone
lead.PitchBend(0.5f);

await Task.Delay(500);

// Bend down by 1 semitone
lead.PitchBend(-0.5f);

await Task.Delay(500);

// Return to center
lead.PitchBend(0.0f);

// Stop note
lead.NoteOff(60);
```

## MIDI Control Changes

For advanced MIDI control, send control change messages directly:

```csharp
var synth = gm(GeneralMidiProgram.SynthBrass1);

// Modulation wheel (CC 1)
synth.SendControlChange(1, 64);

// Breath controller (CC 2)
synth.SendControlChange(2, 80);

// Foot controller (CC 4)
synth.SendControlChange(4, 100);

// Portamento time (CC 5)
synth.SendControlChange(5, 40);

// Data entry (CC 6)
synth.SendControlChange(6, 64);

// Volume (CC 7) - same as Volume property
synth.SendControlChange(7, 100);

// Balance (CC 8)
synth.SendControlChange(8, 64);

// Pan (CC 10)
synth.SendControlChange(10, 64);  // Center

// Expression (CC 11)
synth.SendControlChange(11, 80);

// Sustain pedal (CC 64)
synth.SendControlChange(64, 127); // On
synth.SendControlChange(64, 0);   // Off

// Portamento on/off (CC 65)
synth.SendControlChange(65, 127);

// Soft pedal (CC 67)
synth.SendControlChange(67, 127);
```

## Combining with MusicEngine Effects

GM instruments can be processed through MusicEngine's effects:

```csharp
var piano = gm(GeneralMidiProgram.AcousticGrandPiano);

// Add reverb
var reverbed = fx.Reverb(piano, "piano-reverb")
    .RoomSize(0.7)
    .Damping(0.5)
    .DryWet(0.3)
    .Build();

// Add delay
var delayed = fx.Delay(reverbed, "piano-delay")
    .Time(0.375)
    .Feedback(0.4)
    .DryWet(0.2)
    .Build();

// Use the effected instrument in patterns
var pattern = CreatePattern(delayed);
```

## Practical Examples

### Simple Piano Song

```csharp
var piano = gm(GeneralMidiProgram.AcousticGrandPiano);
piano.Volume = 0.8f;

var pattern = CreatePattern(piano);
pattern.AddNote(0.0, 60, 100, 0.5);  // C
pattern.AddNote(0.5, 64, 100, 0.5);  // E
pattern.AddNote(1.0, 67, 100, 0.5);  // G
pattern.AddNote(1.5, 72, 100, 1.0);  // C
pattern.Loop = true;

SetBpm(120);
pattern.Play();
Start();
```

### Jazz Trio

```csharp
// Piano
var piano = gm(GeneralMidiProgram.ElectricGrandPiano, 0);
piano.Volume = 0.7f;

// Bass
var bass = gm(GeneralMidiProgram.AcousticBass, 1);
bass.Volume = 0.8f;

// Drums
var drums = gm(GeneralMidiProgram.SynthDrum, 9);
drums.Volume = 0.6f;

// Create patterns for each instrument
var pianoPattern = CreatePattern(piano);
var bassPattern = CreatePattern(bass);
var drumPattern = CreatePattern(drums);

// Add notes...
```

### Orchestral Strings

```csharp
// Violins
var violins = gm(GeneralMidiProgram.StringEnsemble1, 0);
violins.SetParameter("pan", 0.3f);
violins.SetParameter("reverb", 0.5f);

// Violas
var violas = gm(GeneralMidiProgram.StringEnsemble2, 1);
violas.SetParameter("pan", -0.2f);
violas.SetParameter("reverb", 0.5f);

// Cellos
var cellos = gm(GeneralMidiProgram.Cello, 2);
cellos.SetParameter("pan", -0.3f);
cellos.SetParameter("reverb", 0.5f);

// Bass
var contrabass = gm(GeneralMidiProgram.Contrabass, 3);
contrabass.SetParameter("pan", 0.0f);
contrabass.SetParameter("reverb", 0.5f);
```

### Electronic Music

```csharp
// Lead synth
var lead = gm(GeneralMidiProgram.Lead2Sawtooth, 0);
lead.SetParameter("pan", 0.5f);

// Bass synth
var bass = gm(GeneralMidiProgram.SynthBass1, 1);
bass.Volume = 0.9f;

// Pad
var pad = gm(GeneralMidiProgram.Pad2Warm, 2);
pad.Volume = 0.4f;
pad.SetParameter("reverb", 0.7f);

// Drums
var drums = gm(GeneralMidiProgram.SynthDrum, 9);
```

### Guitar and Vocals

```csharp
// Acoustic guitar
var guitar = gm(GeneralMidiProgram.AcousticGuitarSteel, 0);
guitar.SetParameter("pan", -0.3f);

// Electric guitar
var electricGuitar = gm(GeneralMidiProgram.ElectricGuitarClean, 1);
electricGuitar.SetParameter("pan", 0.3f);

// Voice/Choir
var vocals = gm(GeneralMidiProgram.ChoirAahs, 2);
vocals.SetParameter("reverb", 0.6f);
```

## Best Practices

1. **Use appropriate channels**: Channel 9 is reserved for drums in GM standard
2. **Layer instruments**: Use multiple channels to create rich textures
3. **Control dynamics**: Use expression and velocity for natural performance
4. **Add effects**: Combine with MusicEngine effects for professional sound
5. **Pan instruments**: Create stereo width by panning instruments left/right
6. **Use reverb wisely**: Add space without muddying the mix
7. **Test on different systems**: GM sounds may vary slightly across Windows versions

## Limitations

- Sound quality depends on Windows synthesizer (Microsoft GS Wavetable Synth)
- Some GM sounds may be basic compared to professional sample libraries
- Limited to 16 MIDI channels
- No direct audio output - `Read()` returns silence (audio is through MIDI device)
- Timing controlled by Windows MIDI subsystem

## See Also

- [Test Script](../test_scripts/12_general_midi_instruments.csx) - Complete examples
- [Scripting API](../SCRIPTING_API.md) - Full API documentation
- [Audio Effects](EFFECTS_REFERENCE.md) - Combining with effects
- [Pattern Control](PATTERN_CONTROL.md) - Using GM instruments with patterns
